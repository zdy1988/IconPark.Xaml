<ZDY:GlassesWindow x:Class="IconPark.Xaml.IconsView.MainWindow"
                   xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
                   xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
                   xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
                   xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
                   xmlns:local="clr-namespace:IconPark.Xaml.IconsView"
                   xmlns:wpftk="clr-namespace:WpfToolkit.Controls;assembly=VirtualizingWrapPanel"
                   xmlns:ZDY="http://www.zdyla.com/coding"
                   xmlns:IconPark="https://iconpark.oceanengine.com"
                   xmlns:Properties="clr-namespace:IconPark.Xaml.IconsView.Properties"
                   WindowStartupLocation="CenterScreen"
                   IsTopmostButtonEnabled="True"
                   IsThemeButtonEnabled="True"
                   IsFullSizedButtonEnabled="True"
                   IsTransparencyButtonEnabled="True"
                   IsTransparency="False"
				   TitleBarPadding="6"
				   IsTitleBarBackgroundEnabled="False"
                   Theme="Dark" Icon="favicon.ico"
                   mc:Ignorable="d"
                   Title="{Binding Path=AppName, Source={x:Static Properties:Settings.Default}}" 
                   Width="996" Height="640">
    <ZDY:GlassesWindow.TitleBarContent>
        <DockPanel>
            <StackPanel DockPanel.Dock="Right" Orientation="Horizontal">
                <ZDY:IconButton x:Name="AboutButton" Icon="About" ToolTip="关于" Click="AboutButton_Click"/>
            </StackPanel>
            <StackPanel>
 
            </StackPanel>
        </DockPanel>
    </ZDY:GlassesWindow.TitleBarContent>
    <ZDY:GlassesWindow.Resources>
        <DataTemplate x:Key="NormalTemplate">
            <Border Width="224" CornerRadius="4" Background="{StaticResource Zhai.Famil.SelectionActivedBrush}">
                <DockPanel>
                    <Border Width="64" Height="64" DockPanel.Dock="Left" Background="Transparent" ToolTip="{Binding Value}">
                        <IconPark:Icon x:Name="PART_Icon" Kind="{Binding Key}" VerticalAlignment="Center" HorizontalAlignment="Center"/>
                    </Border>
                    <Grid DockPanel.Dock="Right" x:Name="MoreButtonContainer" Background="Transparent">
                        <ZDY:IconButton x:Name="MoreButton" Icon="VuesaxOutlineMoreSquare" Margin="10" Opacity="0.8"/>
                        <Popup x:Name="PART_Popup" StaysOpen="True"
                               AllowsTransparency="True" 
                               Focusable="False" VerticalOffset="-15"
                               PopupAnimation="Fade" Visibility="Collapsed"
                               Placement="Bottom">
                            <Popup.HorizontalOffset>
                                <MultiBinding Converter="{ZDY:MathConverter}" ConverterParameter="-(a-b)+10">
                                    <MultiBinding.Bindings>
                                        <Binding ElementName="FlyoutBorder" Path="ActualWidth"/>
                                        <Binding ElementName="MoreButton" Path="ActualWidth"/>
                                    </MultiBinding.Bindings>
                                </MultiBinding>
                            </Popup.HorizontalOffset>
                            <Border x:Name="FlyoutBorder" MinWidth="180"
                                    Effect="{StaticResource Zhai.Famil.FlyoutShadowEffect}" 
                                    Background="{Binding ElementName=PART_Icon, Path=Foreground, Converter={StaticResource FlyoutBackgroundBrushRoundConverter}}">
                                <Grid RenderOptions.ClearTypeHint="Enabled" Margin="6 6">
                                    <StackPanel>
                                        <StackPanel.Resources>
                                            <Style TargetType="{x:Type ZDY:Button}">
                                                <Setter Property="Background" Value="Transparent"/>
                                                <Setter Property="HorizontalContentAlignment" Value="Left"/>
                                            </Style>
                                        </StackPanel.Resources>
                                        <ZDY:Button Content="复制XMAL" Command="{Binding RelativeSource={RelativeSource AncestorType=ZDY:ListBox}, Path=DataContext.ExecuteCopyXAMLCommand}" CommandParameter="{Binding }"/>
                                        <ZDY:Separator/>
                                        <ZDY:Button Content="复制SVG" Command="{Binding RelativeSource={RelativeSource AncestorType=ZDY:ListBox}, Path=DataContext.ExecuteCopySVGCommand}" CommandParameter="{Binding }"/>
                                        <ZDY:Button Content="复制React代码" Command="{Binding RelativeSource={RelativeSource AncestorType=ZDY:ListBox}, Path=DataContext.ExecuteCopyReactCommand}" CommandParameter="{Binding }"/>
                                        <ZDY:Button Content="复制Vue代码" Command="{Binding RelativeSource={RelativeSource AncestorType=ZDY:ListBox}, Path=DataContext.ExecuteCopyVueCommand}" CommandParameter="{Binding }"/>
                                    </StackPanel>
                                </Grid>
                            </Border>
                        </Popup>
                    </Grid>
                    <StackPanel VerticalAlignment="Center">
                        <TextBlock Text="{Binding Value}"/>
                        <TextBlock Text="{Binding Key}" FontSize="11" Margin="0 8 0 0" Opacity="0.8" TextWrapping="NoWrap" TextTrimming="CharacterEllipsis"/>
                    </StackPanel>
                </DockPanel>
            </Border>
            <DataTemplate.Triggers>
                <Trigger SourceName="MoreButtonContainer" Property="IsMouseOver" Value="True">
                    <Setter TargetName="PART_Popup" Property="IsOpen" Value="True"/>
                    <Setter TargetName="PART_Popup" Property="Visibility" Value="Visible"/>
                </Trigger>
            </DataTemplate.Triggers>
        </DataTemplate>
        <DataTemplate x:Key="SimpleTemplate">
            <Border Width="64" CornerRadius="4" Background="{StaticResource Zhai.Famil.SelectionActivedBrush}">
                <Grid x:Name="MoreButtonContainer" Background="Transparent">
                    <Border Width="64" Height="64" DockPanel.Dock="Left" Background="Transparent" ToolTip="{Binding Value}">
                        <IconPark:Icon x:Name="PART_Icon" Kind="{Binding Key}" VerticalAlignment="Center" HorizontalAlignment="Center"/>
                    </Border>
                    <Popup x:Name="PART_Popup" StaysOpen="True"
                           AllowsTransparency="True" 
                           Focusable="False" VerticalOffset="6"
                           PopupAnimation="Fade" Visibility="Collapsed"
                           Placement="Bottom">
                        <Popup.HorizontalOffset>
                            <MultiBinding Converter="{ZDY:MathConverter}" ConverterParameter="-(a-b)/2">
                                <MultiBinding.Bindings>
                                    <Binding ElementName="FlyoutBorder" Path="ActualWidth"/>
                                    <Binding Source="64"/>
                                </MultiBinding.Bindings>
                            </MultiBinding>
                        </Popup.HorizontalOffset>
                        <Border x:Name="FlyoutBorder" MinWidth="180"   
                                Effect="{StaticResource Zhai.Famil.FlyoutShadowEffect}" 
                                Background="{Binding ElementName=PART_Icon, Path=Foreground, Converter={StaticResource FlyoutBackgroundBrushRoundConverter}}">
                            <Grid RenderOptions.ClearTypeHint="Enabled" Margin="6 6">
                                <StackPanel>
                                    <StackPanel.Resources>
                                        <Style TargetType="{x:Type ZDY:Button}">
                                            <Setter Property="Background" Value="Transparent"/>
                                            <Setter Property="HorizontalContentAlignment" Value="Left"/>
                                        </Style>
                                    </StackPanel.Resources>
                                    <ZDY:Button Content="复制XMAL" Command="{Binding RelativeSource={RelativeSource AncestorType=ZDY:ListBox}, Path=DataContext.ExecuteCopyXAMLCommand}" CommandParameter="{Binding }"/>
                                    <ZDY:Separator/>
                                    <ZDY:Button Content="复制SVG" Command="{Binding RelativeSource={RelativeSource AncestorType=ZDY:ListBox}, Path=DataContext.ExecuteCopySVGCommand}" CommandParameter="{Binding }"/>
                                    <ZDY:Button Content="复制React代码" Command="{Binding RelativeSource={RelativeSource AncestorType=ZDY:ListBox}, Path=DataContext.ExecuteCopyReactCommand}" CommandParameter="{Binding }"/>
                                    <ZDY:Button Content="复制Vue代码" Command="{Binding RelativeSource={RelativeSource AncestorType=ZDY:ListBox}, Path=DataContext.ExecuteCopyVueCommand}" CommandParameter="{Binding }"/>
                                </StackPanel>
                            </Grid>
                        </Border>
                    </Popup>
                </Grid>
            </Border>
            <DataTemplate.Triggers>
                <Trigger SourceName="MoreButtonContainer" Property="IsMouseOver" Value="True">
                    <Setter TargetName="PART_Popup" Property="IsOpen" Value="True"/>
                    <Setter TargetName="PART_Popup" Property="Visibility" Value="Visible"/>
                </Trigger>
            </DataTemplate.Triggers>
        </DataTemplate>

        <local:ListBoxItemTemplateConverter x:Key="ListBoxItemTemplateConverter" NormalTemplate="{StaticResource NormalTemplate}" SimpleTemplate="{StaticResource SimpleTemplate}"/>
    </ZDY:GlassesWindow.Resources>

    <ZDY:Drawer x:Name="Drawer" Margin="20 0" IsTopDrawerOpen="True" IsOverlayed="False">
        <ZDY:Drawer.TopDrawerContent>
            <StackPanel Margin=" 0 36 0 24">
                <Image Source="/Resources/logo.png" HorizontalAlignment="Center" MaxWidth="640"/>
                <TextBlock Text="丰富多彩的资源库免费使用" Style="{StaticResource Zhai.Famil.TitleTextBlockStyle}" HorizontalAlignment="Center" Margin="0 32 0 0"/>
                <TextBlock Text="2600+基础图标，29种图标分类，提供更多的选择" HorizontalAlignment="Center" Margin="0 16 0 0"/>
            </StackPanel>
        </ZDY:Drawer.TopDrawerContent>

        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>

            <DockPanel Grid.Row="0" Margin="0 24 0 24">
                <ZDY:SwitchButton x:Name="ListBoxItemTemplateSwitchButton" DockPanel.Dock="Right" Size="48" Margin="24 0 0 0" Foreground="#06a17e">
                    <Grid>
                        <IconPark:Icon x:Name="CheckedIcon" Width="13" Height="13" Kind="ViewGridCard" Foreground="#fff" Visibility="{Binding RelativeSource={RelativeSource AncestorType=ZDY:SwitchButton}, Path=IsChecked, Converter={ZDY:BoolToVisibilityConverter}}"/>
                        <IconPark:Icon x:Name="UnCheckedIcon" Width="13" Height="13" Kind="ViewGridList" Foreground="#fff" Visibility="{Binding RelativeSource={RelativeSource AncestorType=ZDY:SwitchButton}, Path=IsChecked, Converter={ZDY:BoolToInverseVisibilityConverter}}"/>
                    </Grid>
                </ZDY:SwitchButton>

                <ZDY:TextBox x:Name="SearchIconTextBox" Icon="Search" CornerRadius="4" Padding="12 16"
                     Text="{Binding IconKeyword, UpdateSourceTrigger=PropertyChanged}" 
                     ZDY:TextBoxExtension.Placeholder="搜索 ICON ..."
                     GotFocus="SearchIconTextBox_GotFocus" 
                     KeyDown="SearchIconTextBox_KeyDown"/>
            </DockPanel>

            <ZDY:ListBox x:Name="IconsListBox" Grid.Row="1" ItemsSource="{Binding Icons}" SelectionMode="Multiple" Margin="-7" 
                     ZDY:ScrollViewerExtension.IsAutoHideEnabled="False"
                     ItemTemplate="{Binding ElementName=ListBoxItemTemplateSwitchButton, Path=IsChecked, Converter={StaticResource ListBoxItemTemplateConverter}}">
                <ZDY:ListBox.ItemContainerStyle>
                    <Style TargetType="{x:Type ListBoxItem}">
                        <Style.Setters>
                            <Setter Property="Margin" Value="7"/>
                            <Setter Property="Template">
                                <Setter.Value>
                                    <ControlTemplate TargetType="{x:Type ListBoxItem}">
                                        <Grid>
                                            <Border x:Name="SelectedBorder" BorderBrush="#06a17e" BorderThickness="1" CornerRadius="4" Visibility="Collapsed"/>
                                            <ContentPresenter/>
                                        </Grid>
                                        <ControlTemplate.Triggers>
                                            <Trigger Property="IsMouseOver" Value="True">
                                                <Setter TargetName="SelectedBorder" Property="Visibility" Value="Visible"/>
                                            </Trigger>
                                            <Trigger Property="IsSelected" Value="True">
                                                <Setter TargetName="SelectedBorder" Property="Visibility" Value="Visible"/>
                                            </Trigger>
                                        </ControlTemplate.Triggers>
                                    </ControlTemplate>
                                </Setter.Value>
                            </Setter>
                        </Style.Setters>
                    </Style>
                </ZDY:ListBox.ItemContainerStyle>
                <ZDY:ListBox.ItemsPanel>
                    <ItemsPanelTemplate>
                        <wpftk:VirtualizingWrapPanel Orientation="Vertical" SpacingMode="StartAndEndOnly" StretchItems="False"/>
                    </ItemsPanelTemplate>
                </ZDY:ListBox.ItemsPanel>
            </ZDY:ListBox>
        </Grid>
    </ZDY:Drawer>
    


</ZDY:GlassesWindow>